# 実装タスクリスト

- [x] 1. データモデル拡張とタイプ定義の更新
  - `src/lib/notes.ts`の`Note`インターフェースにAI関連フィールド（aiTagged, aiConfidence, processingStatus）を追加
  - 新しいフィールドに対応したバリデーション関数を実装
  - 既存データとの後方互換性を確保するマイグレーション処理を追加
  - _要件: 5.1, 5.2, 5.3_

- [x] 2. ルールベースタグ処理システムの実装
  - ハッシュタグ検出とタグ抽出を行う`RuleBasedTagger`クラスを作成
  - ハッシュタグ除去機能とクリーンコンテンツ生成機能を実装
  - ハッシュタグルール設定（#todo, #idea, #memo, #other）を定義
  - ルールベースタガーのユニットテストを作成（runner未設定のため実行は未接続）
  - _要件: 1.2, 1.3_

- [x] 3. AI処理キューシステムの基盤実装
  - 非同期AI処理用のキューマネージャークラスを作成
  - キューへの追加・取得・処理状態管理機能を実装
  - エラーハンドリングとリトライ機構（指数バックオフ、最大2回）を実装
  - キュー処理のユニットテストを作成
  - _要件: 1.4, 6.2, 6.3_

- [x] 4. Gemini API統合サービスの実装
  - Gemini APIクライアントクラス`GeminiTaggingService`を作成
  - API呼び出し、プロンプト生成、レスポンス解析機能を実装
  - 3秒タイムアウト処理とエラーハンドリングを実装
  - 環境変数からAPIキーを読み込む設定を追加
  - _要件: 1.8, 1.9, 6.1_

- [x] 5. メモ保存フローの更新
  - `src/app/page.tsx`の`saveNote`関数を更新してルールベース処理を統合
  - ハッシュタグありの場合の即座タグ適用処理を実装
  - ハッシュタグなしの場合のAI処理キュー追加処理を実装
  - 保存時の150ms応答性を維持する実装
  - _要件: 1.1, 1.2, 1.4, 6.1_

- [x] 6. AI処理結果のUI反映システム
  - AI処理完了時のタグ更新とUI反映機能を実装
  - エメラルド色（#2dd4bf）でのAIタグ表示機能を実装（`ItemCard` の aiTags を強調）
  - 200ms程度のカラートランジションを実装（`transition-colors duration-200`）
  - AI処理失敗時のデフォルトタグ保持処理を実装
  - _要件: 1.5, 1.6, 1.7_

- [x] 7. キーボードナビゲーション基盤の実装
  - `src/components/bottom-tabs.tsx`にARIA属性（role, aria-selected, aria-controls）を追加
  - roving tabindex実装（アクティブタブのみtabIndex=0、他は-1）
  - タブとパネルの関連付け（aria-controls）を実装
  - _要件: 3.8, 3.9_

- [x] 8. タブキーボードイベントハンドラーの実装
  - ArrowLeft/ArrowRightでのタブフォーカス移動機能を実装
  - Home/Endでの先頭・末尾タブ移動機能を実装
  - Enter/Spaceでのタブアクティブ化機能を実装
  - フォーカスのループ処理（末尾→先頭、先頭→末尾）を実装
  - _要件: 3.3, 3.4, 3.5, 3.6, 3.7_

- [x] 9. 既存キーボードショートカットの削除
  - `src/app/page.tsx`から数字キー（1,2,3）でのタブ切り替え処理を削除
  - Cmd/Ctrl+1/2/3でのタブ切り替え処理を削除
  - ブラウザ標準ショートカットとの競合を解消
  - _要件: 3.1, 3.2_

- [x] 10. モバイルタッチアクセシビリティの改善
  - タブボタンの最小タッチターゲット44x44pxを確保
  - タップ時の即座切り替え機能を維持
  - フォーカス時の視認可能なフォーカスリング表示を実装
  - _要件: 4.1, 4.2, 4.3_

- [ ] 11. タグ編集機能の実装
  - タグクリック時の編集モード切り替え機能を実装
  - 複数タグサポートとタグ追加・削除機能を実装
  - ユーザー手動変更時のAI再適用防止機能を実装
  - タグ編集のユニットテストを作成
  - _要件: 2.1, 2.2, 2.3, 2.4_

- [ ] 12. AIタグバッジコンポーネントの作成
  - AIタグ用エメラルド色バッジコンポーネントを作成
  - 手動タグ用デフォルト色バッジコンポーネントを作成
  - タグ更新時のアニメーション（200msフェード＋色変化）を実装
  - 信頼度スコア表示機能を実装（オプション）
  - _要件: 1.5, 1.6_

- [ ] 13. 統合テストとエラーハンドリングの実装
  - AI処理フロー全体の統合テストを作成
  - キーボードナビゲーション全体の統合テストを作成
  - エラー境界とフォールバック処理を実装
  - パフォーマンステスト（150ms保存応答性）を作成
  - _要件: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 14. 環境設定とデプロイメント準備
  - Gemini API キー用の環境変数設定を追加
  - 本番環境でのAPI制限とエラーハンドリングを設定
  - PWA機能の動作確認とオフライン対応を検証
  - 既存機能の回帰テストを実行
  - _要件: 6.1, 6.4_
